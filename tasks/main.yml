---
- import_tasks: _microk8s.yml
- import_tasks: _plugins.yml

# Remote access
- name: Ensure the host domain is configured in microk8s
  ansible.builtin.lineinfile:
    path: /var/snap/microk8s/current/certs/csr.conf.template
    regexp: "^DNS.6 = .*"
    line: "DNS.6 = {{ ansible_fqdn }}"
    insertafter: '^\[ alt_names \]'

## Certificates
# - name: Ensure microk8s certificate folder exists
#   file:
#     path: /usr/share/ca-certificates/extra
#     state: directory

# - name: Ensure certificates are in place
#   copy:
#     src: "{{ item }}"
#     dest: /usr/share/ca-certificates/extra
#     remote_src: true
#     force: true
#   with_fileglob:
#     - /var/snap/microk8s/current/certs/*ca*.crt

# - name: Trust certificates generated by microk8s
#   command: |
#     update-ca-certificates
